(function(n,e){typeof exports=="object"&&typeof module!="undefined"?e(exports):typeof define=="function"&&define.amd?define(["exports"],e):(n=typeof globalThis!="undefined"?globalThis:n||self,e(n["artalk-plugin-lightbox"]=n["artalk-plugin-lightbox"]||{}))})(this,function(n){"use strict";var S=Object.defineProperty;var A=Object.getOwnPropertySymbols;var _=Object.prototype.hasOwnProperty,m=Object.prototype.propertyIsEnumerable;var x=(n,e,t)=>e in n?S(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,y=(n,e)=>{for(var t in e||(e={}))_.call(e,t)&&x(n,t,e[t]);if(A)for(var t of A(e))m.call(e,t)&&x(n,t,e[t]);return n};var k=(n,e,t)=>new Promise((b,h)=>{var g=o=>{try{s(t.next(o))}catch(l){h(l)}},p=o=>{try{s(t.throw(o))}catch(l){h(l)}},s=o=>o.done?b(o.value):Promise.resolve(o.value).then(g,p);s((t=t.apply(n,e)).next())});var o;const e={lightGallery:"lightGallery",lightBox:"lightbox",fancyBox:"Fancybox",photoSwipe:"PhotoSwipeLightbox"};let t;function b(l){return k(this,null,function*(){var w,u;if(t)return t;t={};for(const r in e)try{if(typeof window!="undefined"&&window[e[r]]?t[r]=window[e[r]]:t[r]=yield(u=(w=l==null?void 0:l[r])==null?void 0:w.lib)==null?void 0:u.call(w),t[r])return t}catch(a){}return t})}const h="atk-lightbox-loaded",g="atk-lightbox-img",p=`.${g}`,s=(l,w)=>{l.on("list-loaded",()=>k(this,null,function*(){const u=[],r=new Set;l.getCommentNodes().forEach(i=>{const f=i.getRender().$content;f.querySelectorAll(`img:not([atk-emoticon]):not([${h}])`).forEach(c=>{c.setAttribute(h,"");const d=document.createElement("a");d.setAttribute("class",g),d.setAttribute("href",c.src),d.setAttribute("data-src",c.src),d.append(c.cloneNode()),c.replaceWith(d),u.push(d)}),r.add(f)});const a=yield b(w);if(a.lightGallery&&r.forEach(i=>{a.lightGallery(i,y({selector:p},window.ATK_LIGHTBOX_CONF||{}))}),a.lightBox&&u.forEach(i=>{window.$(i).attr("data-title",window.$(i).find("img").attr("alt")),window.$(i).attr("rel","lightbox"),i.onclick=f=>{f.preventDefault(),a.lightBox.start(window.$(i))}}),a.photoSwipe){const i=[],f=new a.photoSwipe(y({dataSource:i},window.ATK_LIGHTBOX_CONF||{}));u.forEach(c=>{const d=c.querySelector("img");i.push({src:d.src}),c.onclick=L=>{L.preventDefault(),f.loadAndOpen(0)}}),f.init()}a.fancyBox&&a.fancyBox.then(({FancyBox:i})=>{i&&i.bind(`.artalk .atk-list ${p}`,window.ATK_LIGHTBOX_CONF)})}))};typeof window!="undefined"&&(!window.ArtalkPlugins&&(window.ArtalkPlugins={}),window.ArtalkPlugins.ArtalkLightboxPlugin=s,(o=window.Artalk)==null||o.use(s)),n.ArtalkLightboxPlugin=s,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});
