!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("artalk"),require("katex")):"function"==typeof define&&define.amd?define(["artalk","katex"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Artalk,e.katex)}(this,(function(e,t){"use strict";e.use((e=>{const n=e.getMarked();if(!n)return void console.log("[artalk-plugin-katex] no marked instance found");let r=0;const a=()=>`__atk_katext_id_${r++}__`,o={};function i(e){return e=(e=e.replace(/\$\$([\s\S]+?)\$\$/g,((e,t)=>{const n=a();return o[n]={type:"block",expression:t},n}))).replace(/\$([^\n]+?)\$/g,((e,t)=>{const n=a();return o[n]={type:"inline",expression:t},n}))}const l=new n.Renderer,s=l.listitem,c=l.paragraph,d=l.tablecell,p=l.codespan,u=l.text;l.listitem=(e,t,n)=>s(i(e),t,n),l.paragraph=e=>c(i(e)),l.tablecell=(e,t)=>d(i(e),t),l.codespan=e=>p(i(e)),l.text=e=>u(i(e)),e.updateConf({markedReplacers:[e=>e=e.replace(/(__atk_katext_id_\d+__)/g,((e,n)=>{const r=o[n],a=r.type;let i=r.expression;return i=i.replace(/<br\s*\/?>/gm,"\n"),t.renderToString(i,{displayMode:"block"===a})}))]}),n.use({renderer:l})}))}));
