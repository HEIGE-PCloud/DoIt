(function(n,r){typeof exports=="object"&&typeof module!="undefined"?r(exports,require("katex")):typeof define=="function"&&define.amd?define(["exports","katex"],r):(n=typeof globalThis!="undefined"?globalThis:n||self,r(n["artalk-plugin-katex"]=n["artalk-plugin-katex"]||{},n.katex))})(this,function(n,r){"use strict";var l;const c=/\$.*?\$/,k=/^\$(.*?)\$/,x=/^(?:\s{0,3})\$\$((?:[^\n]|\n[^\n])+?)\n{0,1}\$\$/,o=a=>{let f=0;const p=()=>`__atk_katex_id_${f++}__`,s={},u=(t,e)=>{const i=p();return s[i]={isBlock:e,tex:t},i},g={name:"blockMath",level:"block",tokenizer:t=>{const e=x.exec(t);if(e)return{type:"html",raw:e[0],text:u(e[1],!0)}}},h={name:"inlineMath",level:"inline",start:t=>{const e=t.search(c);return e!==-1?e:t.length},tokenizer:t=>{const e=k.exec(t);if(e)return{type:"html",raw:e[0],text:u(e[1],!1)}}};a.on("mounted",()=>{const t=a.getMarked();if(!t){console.error("[artalk-plugin-katex] no marked instance found in artalk context");return}if(typeof r=="undefined"){console.error("[artalk-plugin-katex] katex not found, please make sure you have imported katex in your project");return}t.use({extensions:[g,h]}),a.updateConf({markedReplacers:[e=>(e=e.replace(/(__atk_katex_id_\d+__)/g,(i,_)=>{const{tex:m,isBlock:y}=s[_];try{return r.renderToString(m,{displayMode:y})}catch(d){return console.error("[artalk-plugin-katex] failed to render katex:",d),`<code>${d}</code>`}}),e)]})})};typeof window!="undefined"&&(!window.ArtalkPlugins&&(window.ArtalkPlugins={}),window.ArtalkPlugins.ArtalkKatexPlugin=o,(l=window.Artalk)==null||l.use(o)),n.ArtalkKatexPlugin=o,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});
