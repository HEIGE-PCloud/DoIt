(function(t,i){typeof exports=="object"&&typeof module!="undefined"?i(exports,require("katex")):typeof define=="function"&&define.amd?define(["exports","katex"],i):(t=typeof globalThis!="undefined"?globalThis:t||self,i(t["artalk-plugin-katex"]=t["artalk-plugin-katex"]||{},t.katex))})(this,function(t,i){"use strict";var k;const l=d=>{d.on("mounted",()=>{const c=d.getMarked();if(!c){console.error("[artalk-plugin-katex] no marked instance found");return}let f=0;const g=()=>`__atk_katex_id_${f++}__`,p={};function s(e){return e=e.replace(/\$\$([\s\S]+?)\$\$/g,(o,a)=>{const r=g();return p[r]={type:"block",expression:a},r}),e=e.replace(/\$([^\n]+?)\$/g,(o,a)=>{const r=g();return p[r]={type:"inline",expression:a},r}),e}const n=new c.Renderer,_=n.listitem,m=n.paragraph,h=n.tablecell,x=n.codespan,w=n.text;n.listitem=(e,o,a)=>_(s(e),o,a),n.paragraph=e=>m(s(e)),n.tablecell=(e,o)=>h(s(e),o),n.codespan=e=>x(s(e)),n.text=e=>w(s(e)),d.updateConf({markedReplacers:[e=>(e=e.replace(/(__atk_katex_id_\d+__)/g,(o,a)=>{const r=p[a],y=r.type;let u=r.expression;return u=u.replace(/<br\s*\/?>/gm,`
`),i.renderToString(u,{displayMode:y==="block"})}),e)]}),c.use({renderer:n})})};typeof window!="undefined"&&(!window.ArtalkPlugins&&(window.ArtalkPlugins={}),window.ArtalkPlugins.ArtalkKatexPlugin=l,(k=window.Artalk)==null||k.use(l)),t.ArtalkKatexPlugin=l,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});
