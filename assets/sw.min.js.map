{"version":3,"sources":["../src/js/sw.js"],"names":[],"mappings":"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","file":"sw.min.js","sourcesContent":["const CACHE_VERSION = 1;\n\nconst BASE_CACHE_FILES = [\n    '/css/style.min.css',\n    '/js/theme.min.js',\n    '/site.webmanifest',\n];\n\nconst OFFLINE_CACHE_FILES = [\n    '/css/style.min.css',\n    '/js/theme.min.js',\n    '/site.webmanifest',\n    '/offline',\n];\n\nconst NOT_FOUND_CACHE_FILES = [\n    '/css/style.min.css',\n    '/js/theme.min.js',\n    '/site.webmanifest',\n    '/404.html',\n];\n\nconst OFFLINE_PAGE = '/offline';\nconst NOT_FOUND_PAGE = '/404.html';\n\nconst CACHE_VERSIONS = {\n    assets: 'assets-v' + CACHE_VERSION,\n    content: 'content-v' + CACHE_VERSION,\n    offline: 'offline-v' + CACHE_VERSION,\n    notFound: '404-v' + CACHE_VERSION,\n};\n\n// Define MAX_TTL's in SECONDS for specific file extensions\nconst MAX_TTL = {\n    '/': 3600,\n    html: 3600,\n    json: 86400,\n    js: 86400,\n    css: 86400,\n};\n\nconst CACHE_BLACKLIST = [\n    (str) => {\n       return !str.startsWith('http://localhost');\n    },\n];\n\nconst SUPPORTED_METHODS = [\n    'GET',\n];\n\n/**\n * isBlackListed\n * @param {string} url\n * @returns {boolean}\n */\nfunction isBlacklisted(url) {\n    return (CACHE_BLACKLIST.length > 0) ? !CACHE_BLACKLIST.filter((rule) => {\n        if (typeof rule === 'function') {\n            return !rule(url);\n        } else {\n            return false;\n        }\n    }).length : false\n}\n\n/**\n * getFileExtension\n * @param {string} url\n * @returns {string}\n */\nfunction getFileExtension(url) {\n    let extension = url.split('.').reverse()[0].split('?')[0];\n    return (extension.endsWith('/')) ? '/' : extension;\n}\n\n/**\n * getTTL\n * @param {string} url\n */\nfunction getTTL(url) {\n    if (typeof url === 'string') {\n        let extension = getFileExtension(url);\n        if (typeof MAX_TTL[extension] === 'number') {\n            return MAX_TTL[extension];\n        } else {\n            return null;\n        }\n    } else {\n        return null;\n    }\n}\n\n/**\n * installServiceWorker\n * @returns {Promise}\n */\nfunction installServiceWorker() {\n    return Promise.all(\n        [\n            caches.open(CACHE_VERSIONS.assets)\n                .then(\n                    (cache) => {\n                        return cache.addAll(BASE_CACHE_FILES);\n                    }\n                ),\n            caches.open(CACHE_VERSIONS.offline)\n                .then(\n                    (cache) => {\n                        return cache.addAll(OFFLINE_CACHE_FILES);\n                    }\n                ),\n            caches.open(CACHE_VERSIONS.notFound)\n                .then(\n                    (cache) => {\n                        return cache.addAll(NOT_FOUND_CACHE_FILES);\n                    }\n                )\n        ]\n    )\n        .then(() => {\n            return self.skipWaiting();\n        });\n}\n\n/**\n * cleanupLegacyCache\n * @returns {Promise}\n */\nfunction cleanupLegacyCache() {\n\n    let currentCaches = Object.keys(CACHE_VERSIONS)\n        .map(\n            (key) => {\n                return CACHE_VERSIONS[key];\n            }\n        );\n\n    return new Promise(\n        (resolve, reject) => {\n\n            caches.keys()\n                .then(\n                    (keys) => {\n                        return legacyKeys = keys.filter(\n                            (key) => {\n                                return !~currentCaches.indexOf(key);\n                            }\n                        );\n                    }\n                )\n                .then(\n                    (legacy) => {\n                        if (legacy.length) {\n                            Promise.all(\n                                legacy.map(\n                                    (legacyKey) => {\n                                        return caches.delete(legacyKey)\n                                    }\n                                )\n                            )\n                                .then(\n                                    () => {\n                                        resolve()\n                                    }\n                                )\n                                .catch(\n                                    (err) => {\n                                        reject(err);\n                                    }\n                                );\n                        } else {\n                            resolve();\n                        }\n                    }\n                )\n                .catch(\n                    () => {\n                        reject();\n                    }\n                );\n        }\n    );\n}\n\nself.addEventListener(\n    'install', event => {\n        event.waitUntil(\n            Promise.all([\n                installServiceWorker(),\n                self.skipWaiting(),\n            ])\n        );\n    }\n);\n\n// The activate handler takes care of cleaning up old caches.\nself.addEventListener(\n    'activate', event => {\n        event.waitUntil(\n            Promise.all(\n                [\n                    cleanupLegacyCache(),\n                    self.clients.claim(),\n                    self.skipWaiting(),\n                ]\n            )\n                .catch(\n                    (err) => {\n                        self.skipWaiting();\n                    }\n                )\n        );\n    }\n);\n\nself.addEventListener(\n    'fetch', event => {\n\n        event.respondWith(\n            caches.open(CACHE_VERSIONS.content)\n                .then(\n                    (cache) => {\n\n                        return cache.match(event.request)\n                            .then(\n                                (response) => {\n\n                                    if (response) {\n\n                                        let headers = response.headers.entries();\n                                        let date = null;\n\n                                        for (let pair of headers) {\n                                            if (pair[0] === 'date') {\n                                                date = new Date(pair[1]);\n                                            }\n                                        }\n                                        if (date) {\n                                            let age = parseInt((new Date().getTime() - date.getTime()) / 1000);\n                                            let ttl = getTTL(event.request.url);\n\n                                            if (ttl && age > ttl) {\n\n                                                return new Promise(\n                                                    (resolve) => {\n\n                                                        return fetch(event.request.clone())\n                                                            .then(\n                                                                (updatedResponse) => {\n                                                                    if (updatedResponse) {\n                                                                        cache.put(event.request, updatedResponse.clone());\n                                                                        resolve(updatedResponse);\n                                                                    } else {\n                                                                        resolve(response)\n                                                                    }\n                                                                }\n                                                            )\n                                                            .catch(\n                                                                () => {\n                                                                    resolve(response);\n                                                                }\n                                                            );\n                                                    }\n                                                )\n                                                    .catch(\n                                                        (err) => {\n                                                            return response;\n                                                        }\n                                                    );\n                                            } else {\n                                                return response;\n                                            }\n\n                                        } else {\n                                            return response;\n                                        }\n\n                                    } else {\n                                        return null;\n                                    }\n                                }\n                            )\n                            .then(\n                                (response) => {\n                                    if (response) {\n                                        return response;\n                                    } else {\n                                        return fetch(event.request.clone())\n                                            .then(\n                                                (response) => {\n\n                                                    if (response.status < 400) {\n                                                        if (~SUPPORTED_METHODS.indexOf(event.request.method) && !isBlacklisted(event.request.url) && event.request.url.slice(0, 4) === 'http') {\n                                                            cache.put(event.request, response.clone());\n                                                        }\n                                                        return response;\n                                                    } else {\n                                                        return caches.open(CACHE_VERSIONS.notFound).then((cache) => {\n                                                            return cache.match(NOT_FOUND_PAGE);\n                                                        })\n                                                    }\n                                                }\n                                            )\n                                            .then((response) => {\n                                                if (response) {\n                                                    return response;\n                                                }\n                                            })\n                                            .catch(\n                                                () => {\n\n                                                    return caches.open(CACHE_VERSIONS.offline)\n                                                        .then(\n                                                            (offlineCache) => {\n                                                                return offlineCache.match(OFFLINE_PAGE)\n                                                            }\n                                                        )\n                                                }\n                                            );\n                                    }\n                                }\n                            )\n                            .catch(\n                                (error) => {\n                                    console.error('  Error in fetch handler:', error);\n                                    throw error;\n                                }\n                            );\n                    }\n                )\n        );\n\n    }\n);\n"]}